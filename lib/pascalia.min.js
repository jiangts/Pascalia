(function(){var a,b,c,d,e,f,g,h,i,j={}.hasOwnProperty,k=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a=function(){function a(a){null==a.value&&(a.value=0),this.level=a.level,this.index=a.index,this.value=a.value}return a.prototype.choose=function(a,b){var c,d,e,f,g;return b>a||0>a||0>b?(console.log("input error: a = "+a+", b = "+b),!1):(b>a-b&&(b=a-b),0===b?1:(d=function(){f=[];for(var c=e=a-b+1;a>=e?a>=c:c>=a;a>=e?c++:c--)f.push(c);return f}.apply(this).reduce(function(a,b){return a*b}),c=function(){g=[];for(var a=1;b>=1?b>=a:a>=b;b>=1?a++:a--)g.push(a);return g}.apply(this).reduce(function(a,b){return a*b}),d/c))},a}(),c=function(b){function c(a){return null==a.level&&(a.level=0),a.value?void c.__super__.constructor.call(this,a):(console.log("parent must have initial value!"),!1)}return k(c,b),c.prototype.getChildren=function(b){var c,d,e,f,g,h,i,j;for(f=[],e=g=i=this.level+1,j=this.level+b;j>=i?j>=g:g>=j;e=j>=i?++g:--g)for(c=Math.abs(this.level-e),d=h=0;c>=0?c>=h:h>=c;d=c>=0?++h:--h)f.push(new a({level:e,index:this.index+d}));return f},c.prototype.hasChild=function(a){var b;return this.index<=(b=a.index)&&b<=this.index+a.level},c}(a),d=function(){function a(){this.cells=[],this.parents=[]}return a.prototype.addCell=function(a){var b;return b=this.hasCell(a),b?void 0:(this.cells.push(a),a instanceof c&&this.parents.push(a),a)},a.prototype.addCells=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.addCell(b));return e},a.prototype.hasCell=function(a){return this.locate(a.level,a.index)?a:!1},a.prototype.locate=function(a,b){var c,d,e,f,g;for(g=this.cells,e=0,f=g.length;f>e;e++)d=g[e],d.level===a&&d.index===b&&(c=d);return null!=c?c:null},a.prototype.populate=function(a){var b,c,d,e,f;for(e=this.parents,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(this.addCells(b.getChildren(a)));return f},a.prototype.calculateCell=function(a){var b,c,d,e;for(e=this.parents,c=0,d=e.length;d>c;c++)b=e[c],b.hasChild(a)&&(a.value+=a.choose(Math.abs(a.level-b.level),Math.abs(a.index-b.index))*b.value);return a.value},a.prototype.calculate=function(){var a,b,d,e,f,g;for(f=this.cells,g=[],b=d=0,e=f.length;e>d;b=++d)a=f[b],a instanceof c==!1?(a.value=this.calculateCell(a),g.push(this.cells[b]=a)):g.push(void 0);return g},a}(),b=function(a){function b(a,c,d){this.sep=null!=d?d:40,b.__super__.constructor.call(this),this.addCells(a),this.populate(c),this.calculate()}return k(b,a),b.prototype.paint=function(){var a,b,c,d;for(d=this.cells,b=0,c=d.length;c>b;b++)a=d[b],e.add(this.createCell(a));return e.renderAll()},b.prototype.createCell=function(a){var b,c,d;return d=a.value.toString(),b=e.width/2-(a.level-2*a.index)*this.sep/Math.sqrt(3),c=(a.level+1)*this.sep,this.paintCell(d,b,c)},b.prototype.paintCell=function(a,b,c){var d,e;switch(!1){case!(0>a):e="red";break;case!(a>0):e="green";break;default:e="blue"}return d=new fabric.Text(a,{left:b,top:c,fill:e,fontSize:20,lockMovementX:!0,lockMovementY:!0}),d.hasControls=d.hasBorders=!1,d},b.prototype.resizeCells=function(){var a,b,c,d,f;for(d=e.getObjects(),f=[],b=0,c=d.length;c>b;b++)a=d[b],f.push(a.scaleToWidth(this.sep));return f},b}(d),e=new fabric.Canvas("c",{selection:!1}),fabric.Object.prototype.originX=fabric.Object.prototype.originY="center",f=new c({index:1,value:1}),g=new c({index:0,value:-3}),h=new c({index:-1,value:2}),i=new b([f,g,h],20),i.paint()}).call(this);