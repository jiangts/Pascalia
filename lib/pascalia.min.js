(function(){var Cell,Painter,Parent,Pascal,canvas,context,p1,p2,painter,resizeCanvas,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};canvas=$("#c")[0],context=canvas.getContext("2d"),resizeCanvas=function(){return canvas.width=window.innerWidth,canvas.height=window.innerHeight},resizeCanvas(),Cell=function(){function a(a){null==a.value&&(a.value=0),this.level=a.level,this.index=a.index,this.value=a.value}return a.prototype.choose=function(a,b){var c,d,e,f,g;return b>a||0>a||0>b?(console.log("input error: a = "+a+", b = "+b),!1):(b>a-b&&(b=a-b),0===b?1:(d=function(){f=[];for(var c=e=a-b+1;a>=e?a>=c:c>=a;a>=e?c++:c--)f.push(c);return f}.apply(this).reduce(function(a,b){return a*b}),c=function(){g=[];for(var a=1;b>=1?b>=a:a>=b;b>=1?a++:a--)g.push(a);return g}.apply(this).reduce(function(a,b){return a*b}),d/c))},a}(),Parent=function(a){function b(a){return null==a.level&&(a.level=0),a.value?void b.__super__.constructor.call(this,a):(console.log("parent must have initial value!"),!1)}return __extends(b,a),b.prototype.getChildren=function(a){var b,c,d,e,f,g,h,i;for(e=[],d=f=h=this.level+1,i=this.level+a;i>=h?i>=f:f>=i;d=i>=h?++f:--f)for(b=Math.abs(this.level-d),c=g=0;b>=0?b>=g:g>=b;c=b>=0?++g:--g)e.push(new Cell({level:d,index:this.index+c}));return e},b.prototype.hasChild=function(a){var b;return this.index<=(b=a.index)&&b<=this.index+a.level},b}(Cell),Pascal=function(){function a(){this.cells=[],this.parents=[]}return a.prototype.addCell=function(a){var b;return b=this.hasCell(a),b?void 0:(this.cells.push(a),a instanceof Parent&&this.parents.push(a),a)},a.prototype.addCells=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.addCell(b));return e},a.prototype.hasCell=function(a){return this.locate(a.level,a.index)?a:!1},a.prototype.locate=function(a,b){var c,d,e,f,g;for(g=this.cells,e=0,f=g.length;f>e;e++)d=g[e],d.level===a&&d.index===b&&(c=d);return null!=c?c:null},a.prototype.populate=function(a){var b,c,d,e,f;for(e=this.parents,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(this.addCells(b.getChildren(a)));return f},a.prototype.calculateCell=function(a){var b,c,d,e;for(e=this.parents,c=0,d=e.length;d>c;c++)b=e[c],b.hasChild(a)&&(a.value+=a.choose(Math.abs(a.level-b.level),Math.abs(a.index-b.index))*b.value);return a.value},a.prototype.calculate=function(){var a,b,c,d,e,f;for(e=this.cells,f=[],b=c=0,d=e.length;d>c;b=++c)a=e[b],a instanceof Parent==!1?(a.value=this.calculateCell(a),f.push(this.cells[b]=a)):f.push(void 0);return f},a}(),Painter=function(a){function b(a,c,d){this.sep=null!=d?d:40,b.__super__.constructor.call(this),this.addCells(a),this.populate(c),this.calculate()}return __extends(b,a),b.prototype.paint=function(){var a,b,c,d;for(d=this.cells,b=0,c=d.length;c>b;b++)a=d[b],canvas.add(this.createCell(a));return canvas.renderAll()},b.prototype.createCell=function(a){var b,c,d;return d=a.value.toString(),b=canvas.width/2-(a.level-2*a.index)*this.sep/Math.sqrt(3),c=(a.level+1)*this.sep,this.paintCell(d,b,c)},b.prototype.paintCell=function(a,b,c){var d,e;switch(!1){case!(0>a):e="red";break;case!(a>0):e="green";break;default:e="blue"}return d=new fabric.Text(a,{left:b,top:c,fill:e,fontSize:20,lockMovementX:!0,lockMovementY:!0}),d.hasControls=d.hasBorders=!1,d},b.prototype.resizeCells=function(){var a,b,c,d,e;for(d=canvas.getObjects(),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.scaleToWidth(this.sep));return e},b}(Pascal),canvas=new fabric.Canvas("c",{selection:!1}),fabric.Object.prototype.originX=fabric.Object.prototype.originY="center",p1=new Parent({index:0,value:1}),p2=new Parent({index:-1,value:-1}),painter=new Painter([p1,p2],20),painter.paint(),$("#setup").click(function(){var cfg,pair,parents,str,_i,_len;for(str=prompt("Setup top row of Pascal's Matrix"),cfg=eval("["+str+"]"),parents=[],_i=0,_len=cfg.length;_len>_i;_i++)pair=cfg[_i],parents.push(new Parent({index:pair[0],value:pair[1]}));return canvas.clear().renderAll(),painter=new Painter(parents,20),painter.paint()})}).call(this);